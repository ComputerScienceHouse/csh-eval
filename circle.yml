machine:
    timezone: America/New_York
    ghc:
        version: 7.10.1

dependencies:
    cache_directories:
        - "~/.stack"
    override:
        - cabal install stack
    post:
        - echo "create role pvals with password 'circleci';" | psql -U postgres
        - createdb pvals -O pvals
        - git submodule init
        - git submodule update
        - cabal exec -- stack build
        - cabal exec -- stack test --only-snapshot
        - echo 'circleci' > cabal exec -- stack exec -- csh-eval-db-init localhost 5432 pvals pvals

test:
    override:
        - cabal exec -- stack test
    post:
        - cabal exec -- stack haddock
        - cp -r .stack-work/dist/x86_64-linux/Cabal-1.22.2.0/doc/html $CIRCLE_ARTIFACTS/doc
